name: CI - Kiểm tra Chất lượng Code

# Workflow này sẽ chạy khi có push lên nhánh 'main' hoặc 'master'
on:
  push:
    branches: ["main", "master"]

jobs:
  # JOB CHÍNH: CHẠY BÀI KIỂM THỬ (CI)
  # Đảm bảo tất cả các service hoạt động đúng trước khi tiến hành các bước khác
  run-tests:
    name: 🧪 Install & Test All Services
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # CÀI ĐẶT DEPENDENCIES CHO AUTH
      - name: Install dependencies for auth service
        run: npm install
        working-directory: ./auth # <--- Bắt buộc chạy lệnh trong thư mục 'auth'

      # CÀI ĐẶT DEPENDENCIES CHO PRODUCT
      - name: Install dependencies for product service
        run: npm install
        working-directory:
          ./product # <--- Bắt buộc chạy lệnh trong thư mục 'product'
          # Bạn có thể thêm các service khác vào đây nếu cần

      # CHẠY TEST CHO AUTH
      - name: Testing auth service
        run: npm test
        working-directory: ./auth # <--- Bắt buộc chạy lệnh test trong thư mục 'auth'

      # CHẠY TEST CHO PRODUCT
      - name: Testing product service
        run: npm test
        working-directory:
          ./product # <--- Bắt buộc chạy lệnh test trong thư mục 'product'
          # Chạy test cho các service khác...

      - name: ✅ All tests passed successfully
        run: echo "🎉 All tests passed!"
