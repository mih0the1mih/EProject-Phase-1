name: CI - Kiểm tra Chất lượng Code

# Workflow này sẽ chạy khi có push lên nhánh 'main' hoặc 'master'
on:
  push:
    branches: ["main", "master"]

jobs:
  # JOB CHÍNH: CHẠY BÀI KIỂM THỬ (CI)
  # Đảm bảo tất cả các service hoạt động đúng trước khi tiến hành các bước khác
  run-tests:
    name: 🧪 Install & Test All Services
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # Cài đặt dependencies cho từng service
      - name: Install dependencies for all services
        run: |
          echo "📦 Installing dependencies for auth service..."
          cd auth && npm install && cd ..
          echo "📦 Installing dependencies for product service..."
          cd product && npm install && cd ..
          # Bạn có thể thêm các service khác vào đây nếu cần

      # Chạy các bài kiểm thử
      - name: Run tests for each service
        run: |
          echo "🧪 Testing auth service..."
          cd auth && npm test && cd ..
          echo "🧪 Testing product service..."
          cd product && npm test && cd ..
          # Chạy test cho các service khác...
          echo "🎉 All tests passed!"
